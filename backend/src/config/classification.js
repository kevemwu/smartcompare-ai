// LLM 分類 Prompt 配置
const LLM_PROMPTS = {
  CATEGORY_CLASSIFICATION: `你是專業的電商商品分類AI。分析商品並分類，只返回JSON。

搜尋查詢: "{{SEARCH_QUERY}}"

商品列表:
{{PRODUCT_LIST}}

**任務要求**:
1. 仔細分析每個商品的名稱(name)和描述(description)
2. 根據商品的實際特性、功能、用途和屬性來理解商品本質
3. 基於商品的相似性和共同特徵，智能生成合適的分類名稱
4. 考慮用戶搜尋意圖，確保分類能滿足用戶需求
5. 生成的分類應該具有實用性和直觀性

**絕對需要遵守的規則**:
- 傳幾個商品就返回幾個商品，不得有數量上的落差
- 每個商品僅能分類到一個類別
- 嚴格遵守返回的JOSN格式，再三確認不得缺少任何應有的括號

**分類原則**:
- 根據商品功能和用途進行分類（例如：根據實際功能判斷是「清潔用品」、「電子設備」等）
- 考慮商品的目標使用者群體（例如：「嬰幼兒用品」、「寵物用品」）
- 按照商品的應用場景分類（例如：「廚房用具」、「辦公用品」）
- 根據商品的材質或型態特性（例如：「數位產品」、「保養品」）
- 分類名稱要簡潔明瞭，便於用戶理解和瀏覽

**注意事項**:
- 盡量做細分的分類，要讓每個商品都有最符合的類別
- 分類名稱使用繁體中文，符合台灣用戶習慣
- 如果商品特性差異很大，可以創建多個不同的分類
- 優先考慮用戶搜尋查詢的相關性

**請嚴格遵守並返回以下JSON格式**:
{
  "categories": [
    {
      "name": "手機配件",
      "description": "手機相關配件用品",
      "productIndexes": [0, 3, 5]
    },
    {
      "name": "電腦周邊", 
      "description": "電腦相關設備",
      "productIndexes": [1, 2, 4]
    }
  ]
}

重要: 只返回JSON，確保格式正確，不要額外說明。`
};

// 傳統關鍵字匹配規則
const KEYWORD_RULES = {
  // 3C電子產品
  ELECTRONICS: {
    category: '3C電子',
    keywords: ['手機', '電腦', '平板', '耳機', '相機', '穿戴裝置'],
    subcategories: {
      '手機與通訊': ['手機', 'iphone', 'android', '充電器', '手機殼', '保護貼'],
      '電腦設備': ['筆電', '桌機', '鍵盤', '滑鼠', '螢幕', '印表機'],
      '影音娛樂': ['耳機', '喇叭', '投影機', '麥克風', '音響'],
      '攝影器材': ['相機', '鏡頭', '攝影機', '運動相機', '空拍機'],
      '智慧穿戴': ['智慧手錶', '智慧手環', '運動手環']
    }
  },

  // 居家生活
  HOME_LIVING: {
    category: '居家生活',
    keywords: ['家具', '寢具', '收納', '廚房', '衛浴'],
    subcategories: {
      '家具傢俱': ['沙發', '桌子', '椅子', '床架', '衣櫃', '書櫃'],
      '寢具寢飾': ['床墊', '棉被', '枕頭', '床包', '床罩'],
      '收納整理': ['收納箱', '置物架', '衣架', '收納櫃'],
      '廚房用品': ['鍋具', '餐具', '刀具', '保鮮盒'],
      '衛浴用品': ['浴簾', '馬桶', '浴室收納', '蓮蓬頭']
    }
  },

  // 美妝保養
  BEAUTY: {
    category: '美妝保養',
    keywords: ['保養', '彩妝', '香水', '美髮', '美體'],
    subcategories: {
      '臉部保養': ['面霜', '精華液', '面膜', '洗面乳'],
      '彩妝美妝': ['粉底', '口紅', '眼影', '睫毛膏'],
      '香氛產品': ['香水', '香氛', '精油', '擴香'],
      '美髮護理': ['洗髮精', '護髮', '造型', '染髮'],
      '身體保養': ['乳液', '防曬', '除毛', '護手']
    }
  },

  // 運動戶外
  SPORTS: {
    category: '運動戶外',
    keywords: ['運動', '健身', '戶外', '露營', '游泳'],
    subcategories: {
      '運動器材': ['跑步機', '啞鈴', '瑜珈墊', '健身器材'],
      '運動服飾': ['運動衣', '運動褲', '運動鞋', '運動內衣'],
      '戶外用品': ['帳篷', '睡袋', '登山杖', '背包'],
      '水上活動': ['泳衣', '泳鏡', '浮潛用品'],
      '單車用品': ['自行車', '車燈', '車鎖', '維修工具']
    }
  },

  // 服飾配件
  FASHION: {
    category: '服飾配件',
    keywords: ['服飾', '鞋子', '包包', '配件', '飾品'],
    subcategories: {
      '男女服飾': ['上衣', '褲子', '外套', '洋裝', '內衣'],
      '鞋類': ['休閒鞋', '皮鞋', '靴子', '拖鞋', '涼鞋'],
      '包包皮件': ['後背包', '手提包', '皮夾', '行李箱'],
      '配件飾品': ['帽子', '圍巾', '皮帶', '襪子'],
      '珠寶飾品': ['項鍊', '戒指', '耳環', '手錶']
    }
  },

  // 母嬰親子
  BABY_KIDS: {
    category: '母嬰親子',
    keywords: ['嬰兒', '兒童', '玩具', '孕婦', '育兒'],
    subcategories: {
      '嬰兒用品': ['尿布', '奶瓶', '嬰兒車', '嬰兒床'],
      '兒童用品': ['童裝', '童鞋', '書包', '文具'],
      '玩具益智': ['積木', '玩具車', '娃娃', '益智玩具'],
      '孕婦用品': ['孕婦裝', '哺乳用品', '營養品'],
      '育兒用品': ['奶粉', '副食品', '餐具', '安全用品']
    }
  },

  // 美食特產
  FOOD: {
    category: '美食特產',
    keywords: ['食品', '飲料', '零食', '生鮮', '農產'],
    subcategories: {
      '零食點心': ['餅乾', '糖果', '零食', '堅果'],
      '飲料沖泡': ['咖啡', '茶葉', '飲料', '酒類'],
      '生鮮食材': ['蔬果', '肉品', '海鮮', '蛋奶'],
      '調理食品': ['泡麵', '罐頭', '調理包', '冷凍食品'],
      '農產特產': ['米', '油', '乾貨', '地方特產']
    }
  },

  // 家電影音
  APPLIANCES: {
    category: '家電影音',
    keywords: ['家電', '影音', '空調', '廚電'],
    subcategories: {
      '生活家電': ['吸塵器', '清淨機', '電風扇', '除濕機'],
      '廚房家電': ['電鍋', '微波爐', '咖啡機', '果汁機'],
      '大型家電': ['冰箱', '洗衣機', '冷氣', '電視'],
      '個人家電': ['吹風機', '刮鬍刀', '美容家電'],
      '影音設備': ['音響', '擴大機', '藍芽喇叭']
    }
  },

  // 居家修繕
  HOME_IMPROVEMENT: {
    category: '居家修繕',
    keywords: ['工具', '五金', '修繕', '園藝'],
    subcategories: {
      '工具五金': ['工具箱', '電動工具', '手工具', '量測工具'],
      '居家修繕': ['油漆', '壁紙', '膠帶', '五金配件'],
      '居家安全': ['監視器', '門鎖', '保險箱', '感應燈'],
      '園藝用品': ['園藝工具', '肥料', '花盆', '植栽'],
      '清潔用品': ['清潔劑', '掃具', '垃圾桶', '除蟲用品']
    }
  },

  // 寵物生活
  PETS: {
    category: '寵物生活',
    keywords: ['寵物', '狗', '貓', '寵物用品'],
    subcategories: {
      '寵物飼料': ['狗飼料', '貓飼料', '寵物罐頭', '零食'],
      '寵物用品': ['寵物床', '寵物玩具', '寵物衣服', '外出用品'],
      '寵物保健': ['寵物保健', '寵物美容', '寵物醫療'],
      '貓咪用品': ['貓砂', '貓跳台', '貓抓板', '貓籠'],
      '狗狗用品': ['狗屋', '狗籠', '狗鍊', '狗玩具']
    }
  },

  // 書籍文具
  BOOKS_STATIONERY: {
    category: '書籍文具',
    keywords: ['書籍', '文具', '辦公', '樂器'],
    subcategories: {
      '圖書書籍': ['小說', '漫畫', '雜誌', '教科書'],
      '文具用品': ['筆', '紙張', '文具組', '計算機'],
      '辦公用品': ['辦公設備', '事務機器', '辦公傢俱'],
      '樂器周邊': ['樂器', '樂譜', '配件', '教學'],
      '藝術用品': ['畫具', '美術用品', '創作材料']
    }
  }
};

// 分類配置
const CLASSIFICATION_CONFIG = {
  // LLM 配置
  llm: {
    provider: process.env.LLM_PROVIDER || 'ollama',
    // Ollama 配置
    ollamaUrl: process.env.OLLAMA_URL || 'http://localhost:11434',
    model: process.env.OLLAMA_MODEL || 'qwen2:7b',
    // Gemini 配置（備用）
    apiKey: process.env.GEMINI_API_KEY,
    timeout: 60000, // 本地模型可能需要更長時間
    maxRetries: 3,
    retryDelay: 5000, // 本地模型不需要太長延遲
    temperature: 0.1,
    maxTokens: 4000
  },
  
  // 快取配置
  cache: {
    ttl: 24 * 60 * 60 * 1000, // 24小時
    maxSize: 10000,
    batchSize: 20
  },
  
  // 降級策略配置
  fallback: {
    enabled: true,
    useKeywordMatch: true,
    maxKeywordMatchScore: 0.8,
    defaultCategory: '其他商品'
  },

  // API 限制配置
  apiLimits: {
    maxProductsPerRequest: 50,
    requestDelay: 200, // ms
    dailyLimit: 1000
  }
};

module.exports = {
  LLM_PROMPTS,
  KEYWORD_RULES,
  CLASSIFICATION_CONFIG
}; 